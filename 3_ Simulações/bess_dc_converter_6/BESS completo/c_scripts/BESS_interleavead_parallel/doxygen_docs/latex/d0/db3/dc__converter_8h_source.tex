\doxysection{dc\+\_\+converter.\+h}
\hypertarget{dc__converter_8h_source}{}\label{dc__converter_8h_source}\mbox{\hyperlink{dc__converter_8h}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{preprocessor}{\#ifndef\ DC\_CONVERTER\_H}}
\DoxyCodeLine{00002\ \textcolor{preprocessor}{\#define\ DC\_CONVERTER\_H}}
\DoxyCodeLine{00003\ }
\DoxyCodeLine{00004\ \textcolor{preprocessor}{\#include\ <math.h>}}
\DoxyCodeLine{00005\ }
\DoxyCodeLine{00006\ \textcolor{comment}{//\ Input\ Definitions}}
\DoxyCodeLine{00007\ \textcolor{preprocessor}{\#define\ Ibat\ Input(0)}}
\DoxyCodeLine{00008\ \textcolor{preprocessor}{\#define\ Ibat2\ Input(1)}}
\DoxyCodeLine{00009\ \textcolor{preprocessor}{\#define\ Ibat3\ Input(2)}}
\DoxyCodeLine{00010\ \textcolor{preprocessor}{\#define\ Ibat4\ Input(3)}}
\DoxyCodeLine{00011\ \textcolor{preprocessor}{\#define\ Ibat5\ Input(4)}}
\DoxyCodeLine{00012\ \textcolor{preprocessor}{\#define\ Ibat6\ Input(5)}}
\DoxyCodeLine{00013\ \textcolor{preprocessor}{\#define\ control\_enable\ Input(6)}}
\DoxyCodeLine{00014\ \textcolor{preprocessor}{\#define\ Iref\_ch\ Input(7)}}
\DoxyCodeLine{00015\ \textcolor{preprocessor}{\#define\ Iref\_dis\ Input(8)}}
\DoxyCodeLine{00016\ \textcolor{preprocessor}{\#define\ Vbat\ Input(9)}}
\DoxyCodeLine{00017\ \textcolor{preprocessor}{\#define\ Vdc\ Input(10)}}
\DoxyCodeLine{00018\ \textcolor{preprocessor}{\#define\ Soc\ Input(11)}}
\DoxyCodeLine{00019\ \textcolor{preprocessor}{\#define\ reset\ Input(12)}}
\DoxyCodeLine{00020\ }
\DoxyCodeLine{00021\ \textcolor{comment}{//\ Parameter\ Definitions}}
\DoxyCodeLine{00022\ \textcolor{preprocessor}{\#define\ fsw\ ParamRealData(0,0)\ \ \ \ }}
\DoxyCodeLine{00023\ \textcolor{preprocessor}{\#define\ Ts\ ParamRealData(1,0)\ \ \ }}
\DoxyCodeLine{00024\ \textcolor{preprocessor}{\#define\ fdsp\ ParamRealData(2,0)\ \ }}
\DoxyCodeLine{00025\ \textcolor{preprocessor}{\#define\ Kpbt\ ParamRealData(3,0)\ \ \ }}
\DoxyCodeLine{00026\ \textcolor{preprocessor}{\#define\ Kibt\ ParamRealData(4,0)\ \ \ }}
\DoxyCodeLine{00027\ \textcolor{preprocessor}{\#define\ Kpvbu\ ParamRealData(5,0)\ \ \ }}
\DoxyCodeLine{00028\ \textcolor{preprocessor}{\#define\ Kivbu\ ParamRealData(6,0)\ \ }}
\DoxyCodeLine{00029\ \textcolor{preprocessor}{\#define\ Kpibu\ ParamRealData(7,0)\ \ \ }}
\DoxyCodeLine{00030\ \textcolor{preprocessor}{\#define\ Kiibu\ ParamRealData(8,0)\ \ }}
\DoxyCodeLine{00031\ \textcolor{preprocessor}{\#define\ Soc\_min\ ParamRealData(9,0)\ \ \ }}
\DoxyCodeLine{00032\ \textcolor{preprocessor}{\#define\ Soc\_max\ ParamRealData(10,0)\ \ \ }}
\DoxyCodeLine{00033\ \textcolor{preprocessor}{\#define\ Nb\_series\ ParamRealData(11,0)\ \ \ }}
\DoxyCodeLine{00034\ \textcolor{preprocessor}{\#define\ Nb\_strings\ ParamRealData(12,0)\ \ }}
\DoxyCodeLine{00035\ }
\DoxyCodeLine{00036\ \textcolor{preprocessor}{\#define\ N\_br\ \ 6\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ }\textcolor{comment}{//\ Number\ of\ interleaved\ phases}}
\DoxyCodeLine{00037\ \textcolor{preprocessor}{\#define\ PRD\ \ ((fdsp/fsw)/2)\ \ \ \ \ \ \ \ \ }\textcolor{comment}{//\ Counter\ period\ for\ up/down\ counting}}
\DoxyCodeLine{00038\ \textcolor{preprocessor}{\#define\ PRD\_div2\ \ (PRD/2)\ \ \ \ \ \ \ \ \ \ \ }\textcolor{comment}{//\ Half\ period}}
\DoxyCodeLine{00039\ \textcolor{preprocessor}{\#define\ pi\ \ \ \ 3.141592653589793\ \ \ }}
\DoxyCodeLine{00040\ \textcolor{preprocessor}{\#define\ wn\ \ \ \ (2*pi*50.0)\ \ \ \ \ \ \ \ \ \ \ }\textcolor{comment}{//\ Fundamental\ angular\ frequency\ (50\ Hz\ assumed)}}
\DoxyCodeLine{00041\ \textcolor{preprocessor}{\#define\ N\ \ \ \ \ 150\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ }\textcolor{comment}{//\ Number\ of\ points\ in\ fundamental}}
\DoxyCodeLine{00042\ }
\DoxyCodeLine{00043\ \textcolor{comment}{//\ Battery\ Parameters}}
\DoxyCodeLine{00044\ \textcolor{keywordtype}{float}\ \mbox{\hyperlink{Code__orignal_2Code__declaration__interleaved_8h_aec2f66b90c73d890ab553c70e2d04dc1}{Vboost}}\ =\ 14.4;\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Boost\ voltage}}
\DoxyCodeLine{00045\ \textcolor{keywordtype}{float}\ \mbox{\hyperlink{Code__orignal_2Code__declaration__interleaved_8h_ac66dbf9a7ab32320154bdd33fb828c82}{Vfloat}}\ =\ 13.6;\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Float\ voltage}}
\DoxyCodeLine{00046\ }
\DoxyCodeLine{00047\ \textcolor{comment}{//\ References}}
\DoxyCodeLine{00048\ \textcolor{keywordtype}{float}\ \mbox{\hyperlink{Code__orignal_2Code__declaration__interleaved_8h_ad8624c7323eaffdc82a875cc4cb2fdfa}{Vref}}\ =\ 0;}
\DoxyCodeLine{00049\ \textcolor{keywordtype}{float}\ \mbox{\hyperlink{dc__converter_8h_a8a9be0f037df55a1cddfa213b62f0bb5}{Ibat\_total}}\ =\ 0;\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Sum\ of\ all\ phase\ currents}}
\DoxyCodeLine{00050\ }
\DoxyCodeLine{00051\ \textcolor{comment}{//\ PI\ Controller\ Structure}}
\DoxyCodeLine{00052\ \textcolor{keyword}{typedef}\ \textcolor{keyword}{struct\ }\{}
\DoxyCodeLine{00053\ \ \ \ \ \textcolor{keywordtype}{float}\ Xref;}
\DoxyCodeLine{00054\ \ \ \ \ \textcolor{keywordtype}{float}\ Xm;}
\DoxyCodeLine{00055\ \ \ \ \ \textcolor{keywordtype}{float}\ erro;}
\DoxyCodeLine{00056\ \ \ \ \ \textcolor{keywordtype}{float}\ erro\_ant;}
\DoxyCodeLine{00057\ \ \ \ \ \textcolor{keywordtype}{float}\ inte;}
\DoxyCodeLine{00058\ \ \ \ \ \textcolor{keywordtype}{float}\ inte\_ant;}
\DoxyCodeLine{00059\ \ \ \ \ \textcolor{keywordtype}{float}\ duty;}
\DoxyCodeLine{00060\ \ \ \ \ \textcolor{keywordtype}{float}\ piout;}
\DoxyCodeLine{00061\ \ \ \ \ \textcolor{keywordtype}{float}\ piout\_sat;}
\DoxyCodeLine{00062\ \ \ \ \ \textcolor{keywordtype}{float}\ erropi;}
\DoxyCodeLine{00063\ \ \ \ \ \textcolor{keywordtype}{float}\ erropi\_ant;}
\DoxyCodeLine{00064\ \ \ \ \ \textcolor{keywordtype}{float}\ dif;}
\DoxyCodeLine{00065\ \ \ \ \ \textcolor{keywordtype}{float}\ Kp;}
\DoxyCodeLine{00066\ \ \ \ \ \textcolor{keywordtype}{float}\ Ki;}
\DoxyCodeLine{00067\ \}\ \mbox{\hyperlink{structsPI}{sPI}};}
\DoxyCodeLine{00068\ }
\DoxyCodeLine{00069\ \textcolor{preprocessor}{\#define\ PI\_default\ \{0,0,0,0,0,0,0,0,0,0,0,0,0,0,0\}}}
\DoxyCodeLine{00070\ }
\DoxyCodeLine{00071\ \textcolor{comment}{//\ Arrays\ for\ PI\ Controllers\ (6\ phases)}}
\DoxyCodeLine{00072\ \mbox{\hyperlink{structsPI}{sPI}}\ \mbox{\hyperlink{Code__declaration__interleaved_8h_a5300c822f7fc11e3303425c989a2766c}{PIbt}}[6]\ =\ \{\mbox{\hyperlink{Code__declaration__inverter_8h_a29fc836c7f74862a866e40e780856cc2}{PI\_default}}\};\ \ \ \ \ \ \ \ \textcolor{comment}{//\ Boost\ mode\ PI\ controllers}}
\DoxyCodeLine{00073\ \mbox{\hyperlink{structsPI}{sPI}}\ \mbox{\hyperlink{Code__declaration__interleaved_8h_aa9887d0e8c4da89a4c4d2e39f1b0845e}{PIbu}}[6]\ =\ \{\mbox{\hyperlink{Code__declaration__inverter_8h_a29fc836c7f74862a866e40e780856cc2}{PI\_default}}\};\ \ \ \ \ \ \ \ \textcolor{comment}{//\ Buck\ mode\ PI\ controllers}}
\DoxyCodeLine{00074\ \mbox{\hyperlink{structsPI}{sPI}}\ \mbox{\hyperlink{Code__declaration__interleaved_8h_a6bdb7fb34bf6a5059a902d931b1ef8bd}{PIbuv}}\ =\ \mbox{\hyperlink{Code__declaration__inverter_8h_a29fc836c7f74862a866e40e780856cc2}{PI\_default}};\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Voltage\ PI\ controller\ (shared)}}
\DoxyCodeLine{00075\ }
\DoxyCodeLine{00076\ \textcolor{keywordtype}{float}\ \mbox{\hyperlink{Code__orignal_2Code__declaration__interleaved_8h_a66885542252b7007c5ddbcb077a26c13}{sat\_up}}\ =\ 1;}
\DoxyCodeLine{00077\ \textcolor{keywordtype}{float}\ \mbox{\hyperlink{Code__orignal_2Code__declaration__interleaved_8h_a28fddb9366e846ecd6f9d3158e35dc8d}{sat\_down}}\ =\ -\/1;}
\DoxyCodeLine{00078\ }
\DoxyCodeLine{00079\ \textcolor{comment}{//\ Ramp\ Structure}}
\DoxyCodeLine{00080\ \textcolor{keyword}{typedef}\ \textcolor{keyword}{struct\ }\{}
\DoxyCodeLine{00081\ \ \ \ \ \textcolor{keywordtype}{float}\ t1;}
\DoxyCodeLine{00082\ \ \ \ \ \textcolor{keywordtype}{float}\ t1\_ant;}
\DoxyCodeLine{00083\ \ \ \ \ \textcolor{keywordtype}{float}\ y;}
\DoxyCodeLine{00084\ \ \ \ \ \textcolor{keywordtype}{float}\ y\_ant;}
\DoxyCodeLine{00085\ \ \ \ \ \textcolor{keywordtype}{float}\ uin;}
\DoxyCodeLine{00086\ \ \ \ \ \textcolor{keywordtype}{float}\ rate;}
\DoxyCodeLine{00087\ \ \ \ \ \textcolor{keywordtype}{float}\ rising;\ }
\DoxyCodeLine{00088\ \ \ \ \ \textcolor{keywordtype}{float}\ falling;}
\DoxyCodeLine{00089\ \}\ \mbox{\hyperlink{structsRamp}{sRamp}};}
\DoxyCodeLine{00090\ }
\DoxyCodeLine{00091\ \textcolor{preprocessor}{\#define\ IRamp\_default\ \{0,0,0,0,0,0,(15),(-\/15)\}\ }}
\DoxyCodeLine{00092\ \textcolor{preprocessor}{\#define\ VRamp\_default\ \{0,0,0,0,0,0,(500),(-\/500)\}\ }}
\DoxyCodeLine{00093\ \mbox{\hyperlink{structsRamp}{sRamp}}\ \mbox{\hyperlink{Code__orignal_2Code__declaration__interleaved_8h_a5f7e1eae4ac28107761e7b792b1d0c63}{IRamp\_bt}}[6]\ =\ \{\mbox{\hyperlink{Code__orignal_2Code__declaration__interleaved_8h_a2564434aeb7fcc2385c0c137f9462026}{IRamp\_default}}\};\ \ \textcolor{comment}{//\ Ramp\ for\ each\ phase}}
\DoxyCodeLine{00094\ \mbox{\hyperlink{structsRamp}{sRamp}}\ \mbox{\hyperlink{Code__declaration__interleaved_8h_ac7d41f5096acb86ca40ae0c143182f92}{VRamp}}\ =\ \mbox{\hyperlink{Code__orignal_2Code__declaration__interleaved_8h_aee96efff7fa5b186dea0c4e37a6d3a3e}{VRamp\_default}};}
\DoxyCodeLine{00095\ }
\DoxyCodeLine{00096\ \textcolor{comment}{//\ Flags}}
\DoxyCodeLine{00097\ \textcolor{keyword}{typedef}\ \textcolor{keyword}{struct\ }\{}
\DoxyCodeLine{00098\ \ \ \ \ \textcolor{keywordtype}{int}\ CM;\ \ \ \ \ \ \textcolor{comment}{//\ Charge\ mode}}
\DoxyCodeLine{00099\ \ \ \ \ \textcolor{keywordtype}{int}\ BVCM;\ \ \ \ \textcolor{comment}{//\ Boost\ Charge\ mode}}
\DoxyCodeLine{00100\ \ \ \ \ \textcolor{keywordtype}{int}\ DM;\ \ \ \ \ \ \textcolor{comment}{//\ Discharge\ mode}}
\DoxyCodeLine{00101\ \}\ \mbox{\hyperlink{structsflag}{sflag}};}
\DoxyCodeLine{00102\ }
\DoxyCodeLine{00103\ \textcolor{preprocessor}{\#define\ IFlag\_default\ \{0,0,1\}\ }}
\DoxyCodeLine{00104\ \mbox{\hyperlink{structsflag}{sflag}}\ \mbox{\hyperlink{Code__orignal_2Code__declaration__interleaved_8h_a5a33421f4c173d14fa2fbd71557ff41c}{flag}}\ =\ \mbox{\hyperlink{Code__orignal_2Code__declaration__interleaved_8h_a5dafe55ef001079f8769ce1b2f5c1b8d}{IFlag\_default}};}
\DoxyCodeLine{00105\ }
\DoxyCodeLine{00106\ \textcolor{comment}{//\ PWM\ Parameters}}
\DoxyCodeLine{00107\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{Code__declaration__interleaved_8h_a8ede2e52ad70ac8928ce0b1b9705b0d7}{count}}[6];\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Counter\ array\ for\ 6\ phases}}
\DoxyCodeLine{00108\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{Code__declaration__interleaved_8h_a3001d76e8836a130df845fc2a9db7ab2}{inc}}[6];\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Increment\ direction\ array}}
\DoxyCodeLine{00109\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{Code__orignal_2Code__declaration__interleaved_8h_a51e63fbf9ca14962fb1b068c222366cc}{CMPB}}\ =\ 0;}
\DoxyCodeLine{00110\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{Code__declaration__interleaved_8h_afcaeacaca5527f362d3e855985e4211e}{S}}[12];\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Switch\ states\ (2\ switches\ per\ phase)}}
\DoxyCodeLine{00111\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{Code__orignal_2Code__declaration__interleaved_8h_a71237b18c216e02629593b1969cff245}{teste}}\ =\ 0;}
\DoxyCodeLine{00112\ }
\DoxyCodeLine{00113\ \textcolor{comment}{//\ Function\ Declarations}}
\DoxyCodeLine{00114\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{dc__converter_8h_a225c5710deab89566bd0fdb6308d623f}{Ramp}}(\mbox{\hyperlink{structsRamp}{sRamp}}\ *rmp,\ \textcolor{keywordtype}{float}\ sample);}
\DoxyCodeLine{00115\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{dc__converter_8h_a7f302b2edf3a02b669719a7e7bf42cdf}{Pifunc}}(\mbox{\hyperlink{structsPI}{sPI}}\ *reg,\ \textcolor{keywordtype}{float}\ T\_div2,\ \textcolor{keywordtype}{float}\ Kp,\ \textcolor{keywordtype}{float}\ Ki,\ \textcolor{keywordtype}{float}\ satup,\ \textcolor{keywordtype}{float}\ satdown);}
\DoxyCodeLine{00116\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{dc__converter_8h_a4cfdc045e8f03d588b31cfa5b112386e}{updateCounters}}(\textcolor{keywordtype}{int}\ \mbox{\hyperlink{Code__declaration__interleaved_8h_a8ede2e52ad70ac8928ce0b1b9705b0d7}{count}}[],\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{Code__declaration__interleaved_8h_a3001d76e8836a130df845fc2a9db7ab2}{inc}}[],\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{Code__declaration__interleaved_8h_a5fda2e88ceb5bbd2c7aa7a30da279f79}{PRD}});}
\DoxyCodeLine{00117\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{dc__converter_8h_a8143eecedcbb60d06b5268a35af70617}{initializePhases}}(\textcolor{keywordtype}{int}\ \mbox{\hyperlink{Code__declaration__interleaved_8h_a8ede2e52ad70ac8928ce0b1b9705b0d7}{count}}[],\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{Code__declaration__interleaved_8h_a3001d76e8836a130df845fc2a9db7ab2}{inc}}[],\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{Code__declaration__interleaved_8h_a5fda2e88ceb5bbd2c7aa7a30da279f79}{PRD}});}
\DoxyCodeLine{00118\ }
\DoxyCodeLine{00119\ \textcolor{preprocessor}{\#endif\ }\textcolor{comment}{//\ DC\_CONVERTER\_H}}

\end{DoxyCode}
